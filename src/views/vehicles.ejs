<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h1 style="color: var(--text-primary); font-weight: 700; font-size: 2rem; margin-bottom: 0.25rem;">
      Vehicle Management
    </h1>
    <p class="text-muted mb-0" style="font-size: 1rem;">
      Track and manage company vehicles and their movements
    </p>
  </div>
  <div class="d-flex gap-3">
    <a href="/movements" class="btn btn-outline-info" style="padding: 0.75rem 1.5rem; font-weight: 600; box-shadow: var(--shadow-sm); margin-right: 0.75rem;">
      üìã View Movements
    </a>
    <button class="btn btn-success" id="recordMovementBtn" style="padding: 0.75rem 1.5rem; font-weight: 600; box-shadow: var(--shadow-sm); margin-right: 0.75rem;">
      üöó Record Entry/Exit
    </button>
    <button class="btn btn-outline-secondary" id="recordExternalMovementBtn" style="padding: 0.75rem 1.5rem; font-weight: 600; box-shadow: var(--shadow-sm);">
      üöô Record External Entry/Exit
    </button>
    <button class="btn btn-primary" id="registerVehicleBtn" data-role="admin" style="padding: 0.75rem 1.5rem; font-weight: 600; box-shadow: var(--shadow-sm);">
      ‚ûï Register Vehicle
    </button>
  </div>
</div>

<!-- Vehicle Stats Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="stat-card info">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="stat-value" id="totalVehicles">0</div>
          <div class="stat-label">Total Vehicles</div>
        </div>
        <div class="stat-icon">üöó</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card success">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="stat-value" id="activeVehicles">0</div>
          <div class="stat-label">Active Vehicles</div>
        </div>
        <div class="stat-icon">‚úÖ</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card warning">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="stat-value" id="onSiteVehicles">0</div>
          <div class="stat-label">Currently On-Site</div>
        </div>
        <div class="stat-icon">üè¢</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card secondary">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="stat-value" id="offSiteVehicles">0</div>
          <div class="stat-label">Currently Off-Site</div>
        </div>
        <div class="stat-icon">üè†</div>
      </div>
    </div>
  </div>
</div>

<!-- Additional Stats Row -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="stat-card danger">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="stat-value" id="maintenanceVehicles">0</div>
          <div class="stat-label">In Maintenance</div>
        </div>
        <div class="stat-icon">üîß</div>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stat-card info">
      <div class="d-flex justify-content-between align-items-start">
        <div>
          <div class="stat-value" id="inactiveVehicles">0</div>
          <div class="stat-label">Inactive Vehicles</div>
        </div>
        <div class="stat-icon">‚è∏Ô∏è</div>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <!-- Empty space for future stats or can be removed -->
  </div>
</div>

<!-- Filters -->
<div class="filters-section mb-4">
  <div class="row g-3 align-items-end">
    <div class="col-md-3">
      <label for="vehicleStatusFilter" class="form-label">Status</label>
      <select class="form-select" id="vehicleStatusFilter">
        <option value="">All Statuses</option>
        <option value="active">Active</option>
        <option value="inactive">Inactive</option>
        <option value="maintenance">In Maintenance</option>
        <option value="retired">Retired</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="vehicleTypeFilter" class="form-label">Type</label>
      <select class="form-select" id="vehicleTypeFilter">
        <option value="">All Types</option>
        <option value="car">Car</option>
        <option value="truck">Truck</option>
        <option value="van">Van</option>
        <option value="motorcycle">Motorcycle</option>
        <option value="bus">Bus</option>
        <option value="other">Other</option>
      </select>
    </div>
    <div class="col-md-3">
      <label for="vehicleSearchInput" class="form-label">Search</label>
      <input type="text" class="form-control" id="vehicleSearchInput" placeholder="License plate, make, model...">
    </div>
    <div class="col-md-3">
      <button class="btn btn-outline-secondary w-100" id="clearVehicleFilters">Clear Filters</button>
    </div>
  </div>
</div>

<!-- Vehicles Table -->
<div class="card">
  <div class="card-body p-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0" id="vehiclesTable">
        <thead class="table-light">
          <tr>
            <th>License Plate</th>
            <th>Type</th>
            <th>Status</th>
            <th>Department</th>
            <th>Assigned Driver</th>
            <th>Mileage</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="vehiclesTableBody">
          <!-- Dynamic content will be loaded here -->
        </tbody>
      </table>
    </div>
    <div class="d-flex justify-content-between align-items-center p-3 border-top">
      <div class="text-muted" id="vehiclePageInfo">Showing 0 of 0 vehicles</div>
      <nav aria-label="Vehicles pagination">
        <ul class="pagination pagination-sm mb-0" id="vehiclePagination"></ul>
      </nav>
    </div>
  </div>
</div>

<!-- Vehicle Registration Modal -->
<div id="vehicleRegistrationModal" class="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Register New Vehicle</h3>
        <button type="button" data-modal-close="vehicleRegistrationModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="vehicleRegistrationForm">
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">License Plate *</label>
                <input type="text" name="licensePlate" class="form-control" required>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Make *</label>
                <input type="text" name="make" class="form-control" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Model *</label>
                <input type="text" name="model" class="form-control" required>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Year *</label>
                <input type="number" name="year" class="form-control" min="1900" max="2099" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Color *</label>
                <input type="text" name="color" class="form-control" required>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Type *</label>
                <select name="type" class="form-control" required>
                  <option value="">Select Type</option>
                  <option value="car">Car</option>
                  <option value="truck">Truck</option>
                  <option value="van">Van</option>
                  <option value="motorcycle">Motorcycle</option>
                  <option value="bus">Bus</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
                <div class="form-group">
                  <label class="form-label">Department</label>
                  <input type="text" name="department" class="form-control">
                </div>
                <!-- Destination moved to movement recording -->
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Assigned Driver</label>
                <input type="text" name="assignedDriver" class="form-control">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Initial Mileage</label>
                <input type="number" name="mileage" class="form-control" min="0" step="0.1">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Status</label>
                <select name="status" class="form-control">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="maintenance">In Maintenance</option>
                  <option value="retired">Retired</option>
                </select>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-modal-close="vehicleRegistrationModal">Cancel</button>
        <button type="submit" form="vehicleRegistrationForm" class="btn btn-primary">Register Vehicle</button>
      </div>
    </div>
  </div>
</div>

<!-- Movement Recording Modal (aligned with movements page) -->
<div class="modal fade" id="movementRecordingModal" tabindex="-1" aria-labelledby="movementRecordingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="movementRecordingModalLabel">Record Entry/Exit</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="movementRecordingForm" novalidate autocomplete="off">
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
          <div class="row g-3">
            <div class="col-12">
              <label for="movementVehicle" class="form-label">Vehicle *</label>
              <select class="form-select" id="movementVehicle" name="vehicleId" required data-choices="true">
                <option value="" disabled selected>Select Vehicle</option>
                <!-- Options populated dynamically -->
              </select>
            </div>
            <div class="col-12">
              <label for="movementType" class="form-label">Movement Type *</label>
              <select class="form-select" id="movementType" name="movementType" required>
                <option value="">Select Type</option>
                <option value="entry">Entry</option>
                <option value="exit">Exit</option>
              </select>
            </div>
            <div class="col-12" id="movementAreaGroup">
              <label for="movementArea" class="form-label">Area/Location *</label>
              <select class="form-select" id="movementArea" name="area" required>
                <option value="" disabled selected>Select Area/Location</option>
                <option value="South Site">South Site</option>
                <option value="Northsite">Northsite</option>
                <option value="Choice Meats">Choice Meats</option>
                <option value="Kasarani">Kasarani</option>
                <option value="Uplands">Uplands</option>
                <option value="Kinangop">Kinangop</option>
                <option value="Eldoret">Eldoret</option>
                <option value="Others">Others</option>
              </select>
            </div>
            <div class="col-12">
              <label for="movementDriver" class="form-label">Driver *</label>
              <select class="form-select" id="movementDriver" name="driverId" required data-choices="true">
                <option value="" disabled selected>Select Driver</option>
              </select>
            </div>
            <div class="col-12">
              <label for="movementMileage" class="form-label">Current Mileage *</label>
              <input type="number" class="form-control" id="movementMileage" name="mileage" min="0" step="0.1" placeholder="Enter current odometer reading" required>
            </div>
            <div class="col-12" id="movementDestinationGroup">
              <label for="movementDestination" class="form-label">Destination</label>
              <select class="form-select" id="movementDestination" name="destination">
                <option value="">Select Destination</option>
                <option value="Field/Event">Field/Event</option>
                <option value="Home">Home</option>
                <option value="Upcountry">Upcountry</option>
                <option value="Mombasa">Mombasa</option>
                <option value="Uganda">Uganda</option>
                <option value="Tanzania">Tanzania</option>
                <option value="Pig Collections">Pig Collections</option>
                <option value="South Site">South Site</option>
                <option value="Northsite">Northsite</option>
                <option value="Choice Meats">Choice Meats</option>
                <option value="Kasarani">Kasarani</option>
                <option value="Uplands">Uplands</option>
                <option value="Kinangop">Kinangop</option>
                <option value="Eldoret">Eldoret</option>
                <option value="Local Sales">Local Sales</option>
                <option value="Others">Others</option>
              </select>
            </div>
            <div class="col-12">
              <label for="movementNotes" class="form-label">Notes</label>
              <textarea class="form-control" id="movementNotes" name="notes" rows="3" placeholder="Additional notes or comments"></textarea>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Record Movement</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Driver Pass Code Confirmation Modal -->
<div class="modal fade" id="movementDriverConfirmModal" tabindex="-1" aria-labelledby="movementDriverConfirmLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="movementDriverConfirmLabel">Confirm Movement Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form id="movementDriverConfirmForm" novalidate autocomplete="off">
        <div class="modal-body">
          <div class="mb-3">
            <div class="fw-semibold">Driver should confirm the details and enter their pass code.</div>
          </div>
          <div id="movementConfirmSummary" class="mb-3 small text-muted">
            <!-- Populated dynamically -->
          </div>
          <div class="mb-3">
            <label for="movementDriverPassCode" class="form-label">Driver Pass Code *</label>
            <input
              type="tel"
              class="form-control secure-input"
              id="movementDriverPassCode"
              name="movementDriverCode"
              maxlength="4"
              inputmode="numeric"
              pattern="\d{4}"
              placeholder="Enter 4-digit pass code"
              autocomplete="one-time-code"
              required
            >
            <div class="form-text">Driver enters their own 4-digit pass code to confirm.</div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Confirm &amp; Save</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- External Movement Recording Modal -->
<div class="modal fade" id="externalMovementModal" tabindex="-1" aria-labelledby="externalMovementModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="externalMovementModalLabel">Record External Vehicle Movement</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="externalMovementForm" novalidate>
        <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
          <div class="row g-3">
            <div class="col-12">
              <label for="externalVehiclePlate" class="form-label">License Plate *</label>
              <input type="text" class="form-control" id="externalVehiclePlate" name="vehiclePlate" placeholder="Enter license plate" required>
            </div>

            <div class="col-12">
              <label for="externalMovementType" class="form-label">Movement Type *</label>
              <select class="form-select" id="externalMovementType" name="movementType" required>
                <option value="">Select Type</option>
                <option value="entry">Entry</option>
                <option value="exit">Exit</option>
              </select>
            </div>

            <div class="col-12" id="externalMovementAreaGroup">
              <label for="externalMovementArea" class="form-label">Area/Location *</label>
              <select class="form-select" id="externalMovementArea" name="area" required>
                <option value="" disabled selected>Select Area/Location</option>
                <option value="South Site">South Site</option>
                <option value="Northsite">Northsite</option>
                <option value="Choice Meats">Choice Meats</option>
                <option value="Kasarani">Kasarani</option>
                <option value="Uplands">Uplands</option>
                <option value="Kinangop">Kinangop</option>
                <option value="Eldoret">Eldoret</option>
                <option value="Others">Others</option>
              </select>
            </div>

            <div class="col-12">
              <label for="externalDriverName" class="form-label">Driver Name *</label>
              <input type="text" class="form-control" id="externalDriverName" name="driverName" placeholder="Enter driver's name" required>
            </div>
            <div class="col-12">
              <label for="externalNotes" class="form-label">Notes</label>
              <textarea class="form-control" id="externalNotes" name="notes" rows="3" placeholder="Additional notes or comments"></textarea>
            </div>

            <!-- Destination removed for external vehicles -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Record Movement</button>
        </div>
      </form>
    </div>
  </div>
</div>
  

<!-- Vehicle Edit Modal -->
<div id="vehicleEditModal" class="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Vehicle</h3>
        <button type="button" data-modal-close="vehicleEditModal">&times;</button>
      </div>
      <div class="modal-body">
        <form id="vehicleEditForm">
          <input type="hidden" id="editVehicleId" name="id">
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">License Plate *</label>
                <input type="text" id="editLicensePlate" name="licensePlate" class="form-control" required>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Make *</label>
                <input type="text" id="editMake" name="make" class="form-control" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Model *</label>
                <input type="text" id="editModel" name="model" class="form-control" required>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Year *</label>
                <input type="number" id="editYear" name="year" class="form-control" min="1900" max="2099" required>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Color *</label>
                <input type="text" id="editColor" name="color" class="form-control" required>
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Type *</label>
                <select id="editVehicleType" name="type" class="form-control" required>
                  <option value="">Select Type</option>
                  <option value="car">Car</option>
                  <option value="truck">Truck</option>
                  <option value="van">Van</option>
                  <option value="motorcycle">Motorcycle</option>
                  <option value="bus">Bus</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Department</label>
                <input type="text" id="editDepartment" name="department" class="form-control">
              </div>
            </div>
            <div class="col-6">
                <!-- Destination moved to movement recording -->
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Assigned Driver</label>
                <input type="text" id="editAssignedDriver" name="assignedDriver" class="form-control">
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Current Mileage</label>
                <input type="number" id="editMileage" name="mileage" class="form-control" min="0" step="0.1">
              </div>
            </div>
            <div class="col-6">
              <div class="form-group">
                <label class="form-label">Status</label>
                <select id="editVehicleStatus" name="status" class="form-control">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="maintenance">In Maintenance</option>
                  <option value="retired">Retired</option>
                </select>
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-modal-close="vehicleEditModal">Cancel</button>
        <button type="submit" form="vehicleEditForm" class="btn btn-primary">Update Vehicle</button>
      </div>
    </div>
  </div>
</div>

<!-- Vehicle Details Modal -->
<div id="vehicleDetailsModal" class="modal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Vehicle Details</h3>
        <button type="button" data-modal-close="vehicleDetailsModal">&times;</button>
      </div>
      <div class="modal-body">
        <div class="vehicle-details">
          <div class="row">
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">License Plate</label>
                <div class="detail-value" id="detailLicensePlate">-</div>
              </div>
            </div>
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Status</label>
                <div class="detail-value" id="detailStatus">-</div>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Make</label>
                <div class="detail-value" id="detailMake">-</div>
              </div>
            </div>
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Model</label>
                <div class="detail-value" id="detailModel">-</div>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Year</label>
                <div class="detail-value" id="detailYear">-</div>
              </div>
            </div>
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Color</label>
                <div class="detail-value" id="detailColor">-</div>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Type</label>
                <div class="detail-value" id="detailType">-</div>
              </div>
            </div>
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Department</label>
                <div class="detail-value" id="detailDepartment">-</div>
              </div>
            </div>
            <!-- Destination is recorded per movement now -->
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Assigned Driver</label>
                <div class="detail-value" id="detailAssignedDriver">-</div>
              </div>
            </div>
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Current Mileage</label>
                <div class="detail-value" id="detailMileage">-</div>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Registered Date</label>
                <div class="detail-value" id="detailCreatedAt">-</div>
              </div>
            </div>
            <div class="col-6">
              <div class="detail-group">
                <label class="detail-label">Last Updated</label>
                <div class="detail-value" id="detailUpdatedAt">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" data-modal-close="vehicleDetailsModal">Close</button>
        <button type="button" class="btn btn-primary" id="editVehicleFromDetailsBtn">Edit Vehicle</button>
      </div>
    </div>
  </div>
</div>

<script src="/js/vehicles.js"></script>